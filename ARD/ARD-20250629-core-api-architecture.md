# ARD-20250629-core-api-architecture

## ステータス
承認済み

## 決定日
2025年6月29日

## 文脈
IoT Temperature Conversion APIのコア実装を開始する。Node.js + TypeScriptベースのRESTful APIとして、NIST標準準拠の高精度温度変換機能を提供する必要がある。

## 決定
以下の技術スタックとアーキテクチャを採用する：

### 1. 技術スタック
- **ランタイム**: Node.js 18+
- **言語**: TypeScript 5.x
- **フレームワーク**: Express.js
- **データベース**: PostgreSQL（将来的にスケーリング時）
- **認証**: JWT + API Key
- **テスト**: Jest + Supertest
- **リクエスト検証**: Joi
- **ドキュメント**: OpenAPI 3.0

### 2. アーキテクチャパターン
- **レイヤー構造**: Controller → Service → Model
- **エラーハンドリング**: RFC 7807準拠の統一エラーレスポンス
- **設定管理**: 環境変数ベースの設定
- **ロギング**: 構造化ログ（Winston）

### 3. パフォーマンス要件
- **単一変換**: 1ms以下（95%パーセンタイル）
- **バッチ変換**: 10ms以下（1,000データポイント）
- **精度**: 有効数字15桁（NIST標準準拠）

### 4. セキュリティ要件
- **暗号化**: TLS 1.3以上
- **認証**: JWT + API Key デュアル認証
- **レート制限**: IP別・APIキー別
- **入力検証**: 厳密な型チェック
- **OWASP**: API Top 10対応

## 理由
### 技術選択の根拠
1. **Node.js + TypeScript**: 高いパフォーマンスと型安全性
2. **Express.js**: 軽量で高速、豊富なミドルウェア
3. **PostgreSQL**: 高精度数値計算とスケーラビリティ
4. **Jest**: 業界標準のテストフレームワーク

### アーキテクチャ選択の根拠
1. **レイヤー構造**: 責任分離と保守性
2. **RFC 7807**: 標準化されたエラーレスポンス
3. **環境変数**: 12-factor app原則準拠
4. **構造化ログ**: 監視・デバッグの効率化

## 代替案
### 代替案A: Fastify + Prisma
- メリット: より高速、型安全なORM
- デメリット: 学習コスト、エコシステム規模

### 代替案B: Next.js API Routes
- メリット: フルスタック統合
- デメリット: API専用としてはオーバースペック

## 影響
### 正の影響
- 高速で安定したAPI提供
- 型安全性による開発効率向上
- 標準準拠による互換性確保

### 負の影響
- 初期セットアップ複雑性
- 複数技術の習得コスト

## 実装計画
1. プロジェクト基盤セットアップ
2. コア温度変換ロジック実装
3. RESTful APIエンドポイント
4. 認証システム
5. テストスイート
6. ドキュメント

## 監視・測定指標
- レスポンス時間（P95）
- 変換精度（有効数字15桁）
- エラー率
- テストカバレッジ（90%以上）
- セキュリティ脆弱性スコア

## 関連するARD
- ARD-20250629-development-flow-standardization.md